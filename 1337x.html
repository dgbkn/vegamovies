<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <meta http-equiv="x-ua-compatible" content="ie=edge" />
  <title>VegaMovies Site</title>
  <!-- MDB icon -->
  <link rel="icon" href="https://vegamovies.pages.dev/img/mdb-favicon.ico" type="image/x-icon" />
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
  <!-- Google Fonts Roboto -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap" />
  <!-- MDB -->
  <link rel="stylesheet" href="https://vegamovies.pages.dev/css/mdb.min.css" />
</head>

<body>


  <div class="d-flex justify-content-center" id="Loader">
    <div class="spinner-border m-5 text-primary" style="width: 3rem; height: 3rem;" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>


  <!-- Start your project here-->
  <div class="container row  w-auto" id="mainContent" style="margin: 10px;margin-top: 30px;">

  </div>
  <!-- End your project here-->




  <!-- MDB -->
  <script type="text/javascript" src="https://vegamovies.pages.dev/js/mdb.min.js"></script>
  <script type="text/javascript">
    var url = new URL(window.location.href);


    function makeRequest(method, url) {
      return new Promise(function (resolve, reject) {
        let xhr = new XMLHttpRequest();
        xhr.open(method, url);
        xhr.onload = function () {
          if (this.status >= 200 && this.status < 300) {
            resolve({
              status: this.status,
              statusText: xhr.statusText,
              responseText: xhr.responseText
            });
          } else {
            reject({
              status: this.status,
              statusText: xhr.statusText
            });
          }
        };
        xhr.onerror = function () {
          reject({
            status: this.status,
            statusText: xhr.statusText
          });
        };
        xhr.send();
      });
    }

    function getWordStr(str) {
      return str.split(/\s+/).slice(0, 10).join(" ");
    }

    function getSearchurl(query) {
      var tamilmc = `https://1337x.torrentdev.workers.dev/sort-search/${encodeURIComponent(query)}/time/desc/1/`;
       return tamilmc;
     // var selector = "tr";
     // return `https://scrap.torrentdev.workers.dev/?url=${encodeURIComponent(tamilmc)}&selector=${encodeURIComponent(selector)}`;
    }
    

  </script>
  <!-- Custom scripts -->
  <script type="text/javascript">

      var url = new URL(window.location.href);
        url = url.searchParams.get("q");
    
    
    function doSearch() {

      if (url) {

        document.getElementById('mainContent').innerHTML = ``;

        document.getElementById("Loader").style = "";

        makeRequest("GET", getSearchurl(url)).then(response => {

          if (response.status == 200) {
            console.log(response.responseText);

            var obj = response.responseText;

            console.log(obj);

            const parser = new DOMParser();
              var doc = parser.parseFromString(obj, "text/html");


            
          var tr = doc.getElementsByTagName("tr");

          var a = doc.getElementsByTagName("a");

      for (c = 0; c < tr.length; c++) {
                          
              const parser = new DOMParser();
              var post = parser.parseFromString(tr[c].innerHTML, "text/html");
              console.log(tr[c].innerHTML);

             var href = post.querySelector('td.coll-1.name > a:nth-child(2)').href;
tr[c].innerHTML = `<div class="ty" onclick="loadEpisodes('${href}')">${tr[c].innerHTML}</div>`;

    }


            document.getElementById("Loader").style = "display:none!important";
            document.getElementById('mainContent').innerHTML = doc.getElementsByTagName("table")[0].innerHTML;


          }


        });



      }
    }





doSearch();
    
    
    
    function loadEpisodes(url) {
      document.getElementById('mainContent').innerHTML = ``;
      document.getElementById("Loader").style = "";

      makeRequest("GET", `https://1337x.torrentdev.workers.dev/${url}`).then(response => {
        if (response.status == 200) {
          console.log(response.responseText);

          var obj = response.responseText;

          console.log(obj);

          document.getElementById("Loader").style = "display:none!important";
          var res = "<button class='btn btn-primary' onClick='doSearch()'>Go Back</button>";

          obj = obj.result[0].innerHTML;

          const parser = new DOMParser();
          var doc = parser.parseFromString(obj, "text/html");

          document.getElementById("Loader").style = "display:none!important";


          var magnet = doc.querySelector('.clearfix ul li a').href;
          var details = doc.querySelector('#description').innerHTML;

          var a = doc.getElementsByTagName("img");
          for (c = 0; c < a.length; c++) {
            a[c].style.maxWidth = "100%";
            a[c].style.height = "auto";
          }
          
                    var res = `
                    <a class="btn btn-primary" href="https://thawning.tanishagoyal.repl.co/seedr/stream?hash=558fa765f980b01f1c2e5e4ae37bfe3502ba33c1ec90cc5bb659dbb250bc6c813bde363a2055bf1ae8d9e0dd101d166fpu3d5hWgFdAHXzF0EumwUE1moKtyN8mjzesi2ym2mbwf4YGUAU3mX5CnWgu42pPwZCfQKQK9GDpAl%2BKm3XbW1A%3D%3D&link=${encodeURIComponent(magnet)}" target="_blank">Direct Stream</a>
                    <a class="btn btn-primary" href="${magnet}">Magnet link</a>
                    ${details}
          `;
          

          document.getElementById('mainContent').innerHTML = res;
        }


      });




    }


  </script>
</body>

</html>
